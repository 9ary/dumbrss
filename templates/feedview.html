{% extends "main.html" %}
{% block title %}{{ title }}{% endblock %}
{% block body %}
    <div id="feedlist">
        <ul>
            <li><a href="/">All</a></li>
            <li><a href="/starred">Starred</a></li>
            {% for feed in current_user.feeds.filter_by(folder_id = None) %}
                <li><a href="/feed/{{ feed.id }}">{{ feed.name }}</a></li>
            {% endfor %}
            {% for folder in current_user.folders %}
                <li>
                    <p><a href="/folder/{{ folder.id }}">{{ folder.name }}</a></p>
                    <ul>
                        {% for feed in folder.feeds %}
                            <li><a href="/feed/{{ feed.id }}">{{ feed.name }}</a></li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div id="entries">
        <table>
            {% for entry in entries.items %}
                <tr>
                    <td>
                        <span id="star{{ entry.id }}"
                            data-starred="{{ entry.starred }}"
                            data-id="{{ entry.id }}"
                            {% if entry.starred == 1 %}
                                class="star glyphicon glyphicon-star"
                            {% else %}
                                class="star glyphicon glyphicon-star-empty"
                            {% endif %}
                            ></span>
                    </td>
                    <td>
                        <img
                         src="{{ entry.feed.icon }}"
                         title="{{ (entry.author + " on ") if entry.author != None }}{{ entry.feed.name }}"
                         >
                    </td>
                    <td><a href="{{ entry.link }}">{{ entry.title }}</a></td>
                    <td>
                        <span
                            data-timestamp="{{ entry.date }}"
                            class="timestamp"
                            id="timestamp{{ entry.id }}"
                            ></span>
                    </td>
                </tr>
            {% endfor %}
        </table>
        <div class=pagination>
            {%- for page in entries.iter_pages() %}
                {% if page %}
                    {% if page != entries.page %}
                        <a href="{{ url_for("feedview", folder_id = folder_id,
                            feed_id = feed_id, starred = starred, p = page) }}">{{ page }}</a>
                    {% else %}
                        <strong>{{ page }}</strong>
                    {% endif %}
                {% else %}
                    <span class=ellipsis>â€¦</span>
                {% endif %}
            {%- endfor %}
        </div>
    </div>
{% endblock %}
{% block js %}
    <script type="text/javascript">
        $("span.timestamp").each(function(i, obj)
        {
            var time = $(this).attr("data-timestamp");
            $(this).html(moment.unix(time).format("D MMM YYYY"));
            $(this).attr("title", moment.unix(time).format("H:mm"));
        });

        $("span.star").click(function()
        {
            if ($(this).attr("data-starred") == "1")
            {
                star = "0";
                $(this).attr("class", "star glyphicon glyphicon-star-empty");
            }
            else
            {
                star = "1";
                $(this).attr("class", "star glyphicon glyphicon-star");
            }
            $(this).attr("data-starred", star);
            $.get("/?a=setstarred&id=" + $(this).attr("data-id") + "&f=" + star);
        });
    </script>
{% endblock %}
